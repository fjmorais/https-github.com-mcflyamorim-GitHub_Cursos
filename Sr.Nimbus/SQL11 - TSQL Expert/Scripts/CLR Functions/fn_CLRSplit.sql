-- Enabling CLR
sp_configure 'clr enabled', 1
GO
RECONFIGURE
GO

-- Publishing Assembly
IF EXISTS(SELECT * FROM sys.assemblies WHERE name = 'Assembly_SplitStringMulti')
BEGIN
  IF OBJECT_ID('fn_SplitStringMulti') IS NOT NULL
    DROP FUNCTION fn_SplitStringMulti

  DROP ASSEMBLY Assembly_SplitStringMulti
END
GO
CREATE ASSEMBLY [Assembly_SplitStringMulti]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030044AC8B510000000000000000E00002210B010B00000E000000060000000000003E2C0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000EC2B00004F000000004000007803000000000000000000000000000000000000006000000C0000002C2B00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000440C000000200000000E000000020000000000000000000000000000200000602E7273726300000078030000004000000004000000100000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001400000000000000000000000000004000004200000000000000000000000000000000202C0000000000004800000002000500C4220000680800000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133004003A0000000100001100026F1100000A2D1B036F1100000A2D13026F1200000A036F1200000A73040000062B11168D16000001168D1600000173040000060A2B00062A4E0003027417000001731300000A81040000012A1E02281400000A2A0000033003004F0000000000000002281400000A000002037D0300000402038E697D0500000402047D0400000402048E69D27D0600000402027B0600000417FE017D0700000402167D0100000402027B06000004155A7D02000004002A0013300400240000000200001100027B03000004027B01000004027B02000004027B0100000459731500000A0A2B00062A133003005E0100000300001100027B02000004027B05000004FE04130411042D07160D38400100000002027B02000004027B06000004587D01000004027B010000040A38CE00000000170B027B0700000416FE01130411042D1E00027B030000040693027B040000041693FE01130411042D02160B002B4900160C2B3400060858027B050000042F16027B0300000406085893027B040000040893FE012B0116130411042D0500160B2B1500081758D20C08027B06000004FE04130411042DBD000716FE01130411042D460002067D02000004027B02000004027B010000045916FE0216FE01130411042D04170D2B780006027B060000041759580A02257B01000004027B06000004587D010000040000000617580A06027B05000004FE04130411043A20FFFFFF02027B02000004027B06000004587D0100000402027B050000047D02000004027B02000004027B010000045916FE0216FE01130411042D04170D2B04160D2B00092A5E0002167D0100000402027B06000004155A7D020000042A000042534A4201000100000000000C00000076322E302E35303732370000000005006C000000F8020000237E000064030000A003000023537472696E6773000000000407000008000000235553000C0700001000000023475549440000001C0700004C01000023426C6F6200000000000000020000015717A2010902000000FA25330016000001000000170000000300000007000000070000000600000001000000150000000E0000000300000001000000010000000100000001000000020000000100000000000A00010000000000060055004E0006006F005C000A009C0087000A00B70087000A0066014B010600AA018B010600D301C1010600EA01C10106000702C10106002602C10106003F02C10106005802C10106007302C10106008E02C1010600A7028B010600BB02C1010600E702D4024700FB02000006002A030A0306004A030A030A0068034B01060092034E00060097034E000000000001000000000001000100010010001F00000005000100010002001000340000000500010004000100F0002F000100F8002F0021000001320021000A013200210014012F0021001E01360021002B0139005020000000009600A5000A0001009620000000009600C10013000300AA20000000008618CF001B000500B420000000008618CF001F000500102100000000E609D50027000700402100000000E601E1002B000700AA2200000000E601EA001B00070000000100450100000200780100000100820102000200860100000100B701000002007801030009002900CF001B003100CF001B003900CF0066004100CF0066004900CF0066005100CF0066005900CF0066006100CF0066006900CF0066007100CF0066007900CF006B008100CF0066008900CF0070009900CF007600A100CF001B00A900CF001B0019007D032B0019008803C8002100CF0066000900CF001B00B900CF00D200200083007B0024000B0040002E003300FC002E001B00E6002E002300FC002E002B00FC002E004B00FC002E003B00E6002E00430002012E006B001A012E007B002C012E005B00FC002E007300230144000B005300CD00DA00DE000300010000003D013C0002000500030004800000010000000D13925400000000000034000000020000000000000000000000010045000000000002000000000000000000000001007B00000000000300020000000000003C4D6F64756C653E0053706C6974537472696E674D756C74692E646C6C0055736572446566696E656446756E6374696F6E730053706C6974537472696E674D756C7469006D73636F726C69620053797374656D004F626A6563740053797374656D2E436F6C6C656374696F6E730049456E756D657261746F720053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C43686172730053706C6974537472696E675F4D756C74690053716C537472696E670046696C6C526F775F4D756C7469002E63746F72006765745F43757272656E74004D6F76654E657874005265736574006C617374506F73006E657874506F7300746865537472696E670064656C696D6974657200737472696E674C656E0064656C696D697465724C656E00697353696E676C654368617244656C696D0043757272656E7400496E707574004D6963726F736F66742E53716C5365727665722E5365727665720053716C46616365744174747269627574650044656C696D69746572006F626A006974656D0053797374656D2E52756E74696D652E496E7465726F705365727669636573004F757441747472696275746500546865537472696E670053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C46756E6374696F6E417474726962757465006765745F49734E756C6C006765745F56616C7565004368617200537472696E670000000003200000000000CA8B6D9866A6684A9021777A923636AC0008B77A5C561934E0890800021209120D120D070002011C10111103200001072002011D031D030320001C0320000202060803061D030206050206020328001C12010001005408074D617853697A65FFFFFFFF12010001005408074D617853697A65FF000000042001010E042001010205200101114904200101084C01000200540E1146696C6C526F774D6574686F644E616D650D46696C6C526F775F4D756C7469540E0F5461626C65446566696E6974696F6E136974656D206E766172636861722834303030290420001D030407011209072003011D0308080307011C07070508020502021501001053706C6974537472696E674D756C7469000005010000000017010012436F7079726967687420C2A920203230313300000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301000000000044AC8B510000000002000000A3000000482B0000480D000052534453AA7D779334EC5444BBA426DEE066EC8508000000433A5C46616269616E6F5C54726162616C686F5C53722E4E696D6275735C437572736F735C53514C3131202D205453514C204578706572745C536372697074735C46756E6374696F6E5C53706C6974537472696E674D756C74695C53706C6974537472696E674D756C74695C6F626A5C44656275675C53706C6974537472696E674D756C74692E7064620000142C000000000000000000002E2C0000002000000000000000000000000000000000000000000000202C0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000200300000000000000000000200334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE000001000000010092540D130000010092540D133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00480020000010053007400720069006E006700460069006C00650049006E0066006F0000005C02000001003000300030003000300034006200300000004C0011000100460069006C0065004400650073006300720069007000740069006F006E0000000000530070006C006900740053007400720069006E0067004D0075006C00740069000000000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003800370037002E0032003100360035003000000000004C001500010049006E007400650072006E0061006C004E0061006D0065000000530070006C006900740053007400720069006E0067004D0075006C00740069002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100330000005400150001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530070006C006900740053007400720069006E0067004D0075006C00740069002E0064006C006C0000000000440011000100500072006F0064007500630074004E0061006D00650000000000530070006C006900740053007400720069006E0067004D0075006C00740069000000000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003800370037002E00320031003600350030000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003800370037002E00320031003600350030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000403C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE
GO
CREATE FUNCTION fn_CLRSplit (@instr nvarchar(MAX), @delimiter nvarchar(4000))
RETURNS TABLE(output nvarchar(4000))
AS
  EXTERNAL NAME Assembly_SplitStringMulti.[UserDefinedFunctions].SplitString_Multi
GO

SELECT * FROM dbo.fn_CLRSplit('1;2;3;4;', ';')